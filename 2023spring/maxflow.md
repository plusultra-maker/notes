# 网络流
> 喻勃洋 2023.4.21 算分小班
- 问题的起源： Shipping oil
  - 表现流的运输网络：
    - 有向
    - 承载能力有上限
    - 不能存储，要满足流的连续性原理
    - >注意这与物理意义上的流不同，水流等的流量是速度和截面的函数，但我们这里相当于规定了速度为1，故不总能满足截面的上界
    - ![图1](./图1.png)
- 最大流
  - 基本假设：
    - $G=(V,E);\: s,t\in V;\: c_e>0$ （不妨假设s只出，t只进，便于后面讨论）
    - 对所有边e:$0\leq f_e \leq c_e$
    - 对于所有非s,t的点u:$$\sum_{(w,u)\in E}f_{wu}=\sum_{(u,z)\in E}f_{uz} $$ 
      >flow is conserved
    - 定义 $size(f)=\sum_{(s,u)\in E}f_su$
  - 综上假设，可以看出线性约束+线性目标函数——线性规划问题
  - 因此我们可以很简单的用单纯形法求解
- 能更进一步吗？
  - 思考单纯形法的本质
    - 在约束规定的区域内，在边界上跑（改变变量的值），且要求变化之后的目标函数值增大，直到找到使目标函数最大的位置
  - 所以实际上单纯形法在最大流中的操作
    - 从无流开始
    - 重复的寻找$s\rightarrow t\:$的通路(how?)，并在其上加上最大可能的flow，作为一次优化
  - 每次添加新的$s\rightarrow t\:$通路 需要满足什么要求呢
    - 目前全图已经有了一个flow的分配：$f_{uv}$，可以维护一个$G^f=(V,E^f)$来储存
    - 对于找到的通路的每个边$u\rightarrow v\:$，如果符合有向，则最多能添加$c_{uv}-f_{uv}$的flow
    - 而如果与本来的有向相反，则可以用来抵消一部分原来的flow，故给出最多$f_{vu}$的flow
    - ![图2](./图2.png)
    - 以此规律，我们得到了一个每条边有确定上限的通路，则显然添加的最大flow为最小的边上限
    - 添加flow后，要更新$G^f$，从而迭代的寻找下一个优化
    - ![图6](./图6.png)
      ![图7](./图7.png) 
- 最优化条件？（A certificate of optimality）
  - 为什么我们认为我们算法的终止即是最优解
  - 单纯形法的终止：
    - 在当下，我们再也找不到任何一种变换使得目标函数更优
    - 其来源是约束方程与目标函数的关系
  - 观察网络流的直观上限
    - 对于任何将s,t分开的分割L和R，跨越分割的$R\rightarrow L\:$的线的总和的最大流的上界（但不总是紧的）,记为$capacity(L,R)$
    - ![图3](./图3.png)
  - 何时是紧的上界
    - 算法终止——无$s\rightarrow t\:$通路——从s能走到的点中没有t
    - 因此可以以此来做一个分割，所有从s能走到的点为L，其余的点为R
    - 故，任何从L到R的边都是满的，任何从R到L的边都是0
    - ![图4](./图4.png)
    - 故，此时有$size(f)=capacity(L,R)$
      - 此上界即为紧的上界，此解即为最优解
    - 有定理：
      - 最小的分割上界即为最大流的最大值
      - >Max-flow min-cut theorem The size of the maximum flow in a network equals the capacity of the smallest (s,t)-cut.
    - 例题（18年期末）：
      - >如果 f 是最大流，那么不存在关于 f 的 s-t 增广链。（√）
- 算法效率
  - 简单分析
    - 每次搜索到一个通路：$O(\left|E\right|)$
    - 总共的迭代次数：
      - 假设边都是整数的承载量，且最大值为C，则最大流的上界总是小于$C\left|E\right|$
      - 且每次找到新通路我们至少增添了1的总流量
    - 因此总复杂度在$O(C{\left|E\right|}^{2})$
  - 这是紧的吗
    - C可能很大，边值可能都很大，如果能一次添加很大的流量，则迭代次数可以降低
  - 通路的搜索策略
    - 看一个例子
    - ![图5](./图5.png)
    - 我们尽量寻找可能的最大流量来作为迭代——贪心
      1. 用Dijkstra的变式算法来解出，图中具有最大流量的通路
      2. 最大流的最大值总是小于图中最多$\left|E\right|$条边的和
      3. 以每次都取最大流量的通路来迭代，迭代次数的上限为$O(\left|E\right|logF)$,$F$是最大流的结果
    - 证明：每次贪心至少可以减少$\frac{F_{last}}{\left|E\right|}$
      - 因此$F_t\leq F(1-\frac{1}{E})^t<F(e^{-1/k})^t=Fe^{-t/k}$
> To learn more, see [$cs170 \:note \:\S7.2$](https://people.eecs.berkeley.edu/~vazirani/algorithms/chap7.pdf)
- 大题例题：18年期末
![18图](./18图.png)
![18图2](./18图2.png)
![18图3](./18图3.png)