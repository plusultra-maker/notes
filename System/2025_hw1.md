# HW1 about 启动与中断异常部分

## 1. Linux的中断处理流程与上下半部

- 总的来说中断处理流程是操作系统响应硬件中断的机制，分为上半部和下半部。
- 首先当中断发生时，系统首先通过中断向量表将中断请求引导到合适的中断处理函数，这部分称为上半部处理。上半部处理的主要任务是快速响应和处理中断源，通常完成较短且必须立即执行的任务，如中断标志的清除和状态更新。处理完毕后，上半部会调度下半部进行进一步处理。
- 上半部的优点是处理时间短，能够快速释放中断资源，保证系统的实时性。下半部则用于处理那些可以延后执行的工作，如数据传输、复杂的计算等。引入上半部和下半部处理的原因是避免中断处理过程过于耗时，导致系统响应延迟，提高中断处理的效率。

## 2. 调研国产操作系统
### 鸿蒙操作系统
鸿蒙是华为开发的分布式操作系统。对于现代人生活使用多个移动设备协同工作来说，分布式操作系统可以很好的实现数据联动、资源联动，从而提高工作效率，这是鸿蒙系统最大的特点。详细的说，分布式系统通过网络将手机、平板、笔记本电脑等设备联系起来，形成一个总的终端，从而使得任务可以被分配到合适的设备上运行并且在需要的设备上显示，统一了负载分配。同时由于手机和笔记本电脑的处理器架构不同，对应的各自的操作系统内核不同，鸿蒙系统支持了多内核，包括鸿蒙微内核，通过“分布式软总线”来实现内核之间的沟通。

### OpenEuler
OpenEuler是华为开发的开源操作系统，其主要针对服务器、云计算等场景提供安全稳定的操作系统。其特点是有开源社区，多元架构支持多种处理器以及支持企业涉及的各种数字设备设施。其基于Linux，并在更新在升级了内核的多核能力，同时支持了多种处理器架构，包括ARM、x86、RISC-V等。同时还更新了支持cpu内存热插拔的功能。

> PS. 参考了chatgpt给出的结果但个人觉得模型给出的答案太笼统，无法突出特色


## 3. xv6-riscv 启动与中断异常机制

### a) 特权模式
xv6-riscv有以下几种特权模式：用户模式（U）、超级用户模式（S）、机器模式（M）。系统的启动过程中会从机器模式开始，执行 boot流程。在代码上首先从start.c开始执行，并进入entry.S，其中包含了从机器模式到超级用户模式的转换过程。这一过程中发送了启用中断，通过sstatus寄存器的设置来切换到超级用户模式。

### b) 系统调用
系统调用号存储在 a7 寄存器中，参数分别存储在 a0 至 a5 寄存器中。返回值存储在 a0 寄存器中

### c) 进程上下文切换时的寄存器

在xv6-riscv的进程上下文切换过程中，需要保存的寄存器包括：sstatus、sepc、scause、stvec 等。恢复过程就是恢复这些寄存器的值，使得进程的整个逻辑从上次中断的位置继续执行

### d) trap 中寄存器的作用

在处理 trap 时，xv6-riscv 使用了一系列控制寄存器：
- stvec
  - 用于设置 trap 向量，指示发生 trap 时跳转的地址
- scause
  - 记录发生 trap 的原因（比如非法指令、中断等）
- sstatus
  - 记录当前的系统状态，用于保存和恢复上下文。
- spec
  - 用于标识特定异常的处理方式

### e) 中断函数
- `devintr` 是一个设备中断的处理函数，用于处理中断来源并调用相应的设备驱动程序，而`uartintr` 是串口中断的处理函数。当 `devintr` 调用时，它会检查是否是串口中断，并在确认后调用 `uartintr` 进行进一步的处理。
- `devintr` 判断是否调用 `uartintr` 的条件通常是检查中断源是否为串口设备。
